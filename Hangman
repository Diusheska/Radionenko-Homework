import codecs
import re
import operator
import tkinter as tk
from tkinter import filedialog
from itertools import chain

print("Hi! Please select a file to open\n")

# give user an option to browse for file. Open file, read, switch to lower
while True:
    try:
        root = tk.Tk().withdraw()
        file_path = filedialog.askopenfilename()
        with codecs.open(file_path, encoding='utf-8') as f_obj:
            text = f_obj.read().lower()
    except FileNotFoundError:
        print("No file or file path\n")
        continue
    else:
        textlist = text.splitlines()
        break

# find max possible length of the word in file
ml = (max(list(map(lambda x: int(len(x)), textlist))))

# ask user for the number of letters in his/her word
print("Now let's play! Select a word from the file and give me few hints.")
while True:
    try:
        wl = int(input("How many letters does your word have?\n"))
    except ValueError:
        print("This is not an integer\n")
        continue
    else:
# check if user input is in within word length
        if 0 < wl <= ml:
            break
        else:
            print("Sorry, no such words in your file\n")
            continue

# define word display
word = ["-"]*wl

# count number of game attempts
attempts = 0

# display how the word looks like
def show_word(w):
    print("\nThis is how the word looks now:")
    print(' '.join(map(str, w)))

# call function to show the word at the beginning
show_word(word)

# list of words filtered based on user's answer
f = list(filter(lambda x: int(len(x)) == wl, textlist))

# count number of words in the filtered list
def filter_length(lst):
    fl = int(len(lst)) # total number of words in the filtered list
    return fl

# show letters those occur in majority of words
def letter_occurances(lst):
    unknown_letters = set(list(filter(lambda x: x not in word, (list(chain.from_iterable(lst))))))
    occurances = []
    for letter in unknown_letters:
        r = re.compile(".*{}".format(letter))
        matched = len(list(filter(r.match, f)))
        occurances.append(matched)
    dictionary = dict(zip(unknown_letters, occurances))
    guess = max(dictionary.items(), key=operator.itemgetter(1))[0]
    freq = dictionary[guess]
    return guess, freq

# sdk user for first letter prompt and update the filtered list based on this prompt
def user_prompt():
    global f
    global word
    # ask for the any letter hint
    print ("\nAny letter prompts? Type your word with letter(s) and '-' in it and hit Enter:")
    while not (f == []):
        inp = input()
        if int(len(inp)) == wl:
            word = inp
            inp = inp.replace("-", ".")
            r = re.compile(inp)
            f = list(filter(r.match, f))
            break
        else:
            print("Sorry, this doesn't match your word length. Please try again:")
            continue
    else:
        print("Sorry, such word doesn't exist in our dictionary. I give up.")

# computer tries to guess the letter:
def try_to_guess():
    global f
    global word
    global attempts
    while not (f == [] or int(len(f)) == 1 or word.count("-") == 0):
        guess, freq = letter_occurances(f)
        print("\nThanks! I guess there could be '{}' in your word.".format(guess),"It is in {} word(s)".format(freq), "with probability of {0:.0%}.".format(freq/(int(len(f)))))
        attempts += 1
        inp = input("Is it there? Type the word with this letter(s) in OR type 'N' for 'no'\n").lower()
        if inp == "n":
    # filter out words with this letter from the list
            f = list(filter(lambda w: all([letter != guess for letter in w]), f))
        else:
            if int(len(inp)) == wl:
                word = inp
                inpt = inp.replace("-", ".")
                r = re.compile(inpt)
                f = list(filter(r.match, f))
            else:
                print("Sorry, this doesn't match your word length. Please try again:\n")
                break
                continue
    else:
        if f == []:
            print("Sorry, such word doesn't exist. Game over, I give up!")
        elif  word.count("-") == 0:
            print("I did it! It took me {} attempt(s)".format(attempts))
            show_word(word)
        elif int(len(f)) == 1:
            print("I know the word! It's '{}', right?".format(''.join(f)),"It took me {} attempt(s)".format(attempts))

# actual game
def play_game():
    user_prompt()
    try_to_guess()

play_game()
